{
  "version": 3,
  "sources": ["../../../../../../apps/workers/src/s3-client.ts"],
  "sourcesContent": ["import { S3Client, GetObjectCommand } from '@aws-sdk/client-s3';\nimport { Logger } from '@nestjs/common';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\n\nconst logger = new Logger('S3Client');\n\nconst s3Client = new S3Client({\n  region: process.env.AWS_REGION || 'us-east-1',\n  credentials: {\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID || 'test-access-key',\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || 'test-secret-key',\n  },\n  ...(process.env.S3_ENDPOINT && {\n    endpoint: process.env.S3_ENDPOINT,\n    forcePathStyle: true,\n  }),\n});\n\nexport async function downloadFromS3(s3Key: string): Promise<string> {\n  try {\n    logger.log(`Downloading ${s3Key} from S3`);\n\n    const command = new GetObjectCommand({\n      Bucket: process.env.S3_BUCKET_NAME || 'audibook-storage',\n      Key: s3Key,\n    });\n\n    const response = await s3Client.send(command);\n    const tempPath = path.join('/tmp', path.basename(s3Key));\n\n    // Save to temp file\n    const data = await response.Body?.transformToByteArray();\n    if (!data) throw new Error('No data received from S3');\n\n    await fs.writeFile(tempPath, data);\n    logger.log(`Downloaded to ${tempPath}`);\n\n    return tempPath;\n  } catch (error) {\n    logger.error(`Failed to download from S3: ${error}`);\n    throw error;\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAA2C;AAC3C,oBAAuB;AACvB,SAAoB;AACpB,WAAsB;AAEtB,MAAM,SAAS,IAAI,qBAAO,UAAU;AAEpC,MAAM,WAAW,IAAI,0BAAS;AAAA,EAC5B,QAAQ,QAAQ,IAAI,cAAc;AAAA,EAClC,aAAa;AAAA,IACX,aAAa,QAAQ,IAAI,qBAAqB;AAAA,IAC9C,iBAAiB,QAAQ,IAAI,yBAAyB;AAAA,EACxD;AAAA,EACA,GAAI,QAAQ,IAAI,eAAe;AAAA,IAC7B,UAAU,QAAQ,IAAI;AAAA,IACtB,gBAAgB;AAAA,EAClB;AACF,CAAC;AAED,eAAsB,eAAe,OAAgC;AACnE,MAAI;AACF,WAAO,IAAI,eAAe,KAAK,UAAU;AAEzC,UAAM,UAAU,IAAI,kCAAiB;AAAA,MACnC,QAAQ,QAAQ,IAAI,kBAAkB;AAAA,MACtC,KAAK;AAAA,IACP,CAAC;AAED,UAAM,WAAW,MAAM,SAAS,KAAK,OAAO;AAC5C,UAAM,WAAW,KAAK,KAAK,QAAQ,KAAK,SAAS,KAAK,CAAC;AAGvD,UAAM,OAAO,MAAM,SAAS,MAAM,qBAAqB;AACvD,QAAI,CAAC;AAAM,YAAM,IAAI,MAAM,0BAA0B;AAErD,UAAM,GAAG,UAAU,UAAU,IAAI;AACjC,WAAO,IAAI,iBAAiB,QAAQ,EAAE;AAEtC,WAAO;AAAA,EACT,SAAS,OAAO;AACd,WAAO,MAAM,+BAA+B,KAAK,EAAE;AACnD,UAAM;AAAA,EACR;AACF;",
  "names": []
}
